<!doctype html>
<html>

<head>
  <title>physics-system</title>
  <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
  <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
  <script>
    // document.addEventListener('DOMContentLoaded', DOMContentLoaded);
    setTimeout(DOMContentLoaded, 2000);
    function DOMContentLoaded(){
      setLaneProp();
      setPinProp();

      const scene = document.querySelector("a-scene");
      const ball = createBall(scene);
      scene.appendChild(ball);
      ball.addEventListener("body-loaded", function(e){
        addForce(this);
      });
    }
    function setLaneProp() {
      const lane = document.querySelector("#lane");
      const attr = {
        shape: "none",
      };
      const main = {
        shape: "box",
        offset: "0 0 -0.001",
        halfExtents: "1.15 12.5 0.001",
      };
      lane.setAttribute("static-body", attr);
      lane.setAttribute("shape__main", main);
    }
    function setPinProp() {
      const pins = document.querySelectorAll(".pin");
      const attr = {
        shape: "cylinder",
      };
      pins.forEach((e)=>{
        e.setAttribute("dynamic-body", attr);
      });
    }
    function createBall(parent) {
      const ball = document.createElement("a-sphere");
      ball.setAttribute("id", "ball");
      ball.setAttribute("color", "#052625");
      ball.setAttribute("emissive", "#1f1d1b");
      ball.setAttribute("position", "0 0.02 -3");
      ball.setAttribute("radius", "0.2");
      ball.setAttribute("dynamic-body", {
        angularDamping: 0.0001,
        linearDamping: 0.0001,
        mass: 30,
      });
      return ball;
    }
    function addForce(ball) {
      const v = new THREE.Vector3(0, -150, -350);
      const p = ball.object3D.position;
      ball.body.applyImpulse(
        new CANNON.Vec3(v.x, v.y, v.z),
        new CANNON.Vec3(p.x, p.y, p.z)
      );
    }
  </script>
</head>

<body>
  <!-- <a-scene physics="debug: true" background="color: #111;"> -->
  <a-scene physics="debug: false" background="color: #111;">
    <a-assets>
      <a-asset-item id="pin" src="model/bowling_pin/scene.gltf"></a-asset-item>
      <a-asset-item id="fieldModel" src="model/bowling_alley_mozilla_hubs_room/scene.gltf"></a-asset-item>
    </a-assets>
    <a-entity light="type: ambient; intensity: 0.8; color: #c1fff6; groundColor: #dcf1ff; decay: 11.68; distance: 12.51; shadowBias: 5.85; shadowCameraFar: 0; shadowCameraFov: 20; shadowCameraBottom: -19.07; shadowRadius: 100"></a-entity>
    <a-light type="directional" intensity="3.8" position="-10 10 10" color="#eeffff" light="intensity: 4"></a-light>
    <a-camera position="0 1 0" fov="30" far="100" zoom="0.8"></a-camera>
    <a-entity id="lane" width="2" height="25" position="0 -1 -15" rotation="-90 0 0"></a-entity>
    <a-entity class="pin" position="0 0 -18.0"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity class="pin" position="0.2 0 -18.2"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity class="pin" position="-0.2 0 -18.2"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity class="pin" position="0 0 -18.4"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity class="pin" position="0.4 0 -18.4"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity class="pin" position="-0.4 0 -18.4"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity class="pin" position="0.6 0 -18.6"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity class="pin" position="0.2 0 -18.6"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity class="pin" position="-0.2 0 -18.6"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity class="pin" position="-0.6 0 -18.6"><a-entity gltf-model="#pin" scale="2 2 2" position="0 -0.34 0"></a-entity></a-entity>
    <a-entity id="field" gltf-model="#fieldModel" position="4.8 0.81 5" scale="26 26 26"></a-entity>
  </a-scene>
  <script></script>
</body>

</html>